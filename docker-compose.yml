version: "3"

services:

  db:
    image: mongo:3.4.3
    labels:
      - just-married-db
    networks:
      backnet:
        ipv4_address: 172.0.1.2
    volumes:
      - ./database/data:/data
      - ./database/dump:/dump
    ports:
      - "27017:27017"

  server:
    image: justmarried/jmserver:production-latest
    labels:
      - just-married-server
    depends_on:
      - db
    networks:
      backnet:
        ipv4_address: 172.0.1.3
    environment:
      - AUTH_REDIRECT_URL=http://localhost:3000/redirect.html?token=%s
      - PROTOCOL=http
      - HOST=192.168.99.100
      - PORT=2701
      - JWT_SECRET=0a6b944d-d2fb-46fc-a85e-0295c986cd9f
      - DB_URL=mongodb://172.0.1.2:27017
      - SESSION_SECRET=secret

  client:
    image: justmarried/jmclient:production-latest
    labels:
      - just-married-client
    networks:
      - justmarriednet
    networks:
      backnet:
        ipv4_address: 172.0.1.4
      frontnet:
        ipv4_address: 172.0.2.2
    ports:
      - "8080:80"

networks:

  backnet:
    ipam:
      config:
        - subnet: 172.0.1.0/24

  frontnet:
    ipam:
      config:
        - subnet: 172.0.2.0/24
